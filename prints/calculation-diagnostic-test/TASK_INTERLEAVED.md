# タスク：問題配列の再構成（ブロック型→インターリーブ型）

## 背景・目的

### 現状の問題点
- **ブロック型配列**: 同じ単元の問題が連続（AAAAA, BBBBB, CCCCC...）
- **学習効果の限界**: 単元ごとにまとまっているため、「パターン認識」に頼りやすく、真の理解が測れない
- **天井効果**: 30問全問正解者が続出し、習熟度の細かい判定ができない

### 目指す方向
- **インターリーブ型配列**: 単元を混ぜた配列（ABC, ABC, ABC...）
- **学習科学の根拠**: Interleaving Effect（インターリーブ効果）により、長期記憶と問題識別能力が向上
- **問題数の拡張**: 30問 → 35問（7単元 × 5難易度レベル）
- **天井効果の解消**: 35問の螺旋配列で、より細かい習熟度判定が可能

---

## 全体構成

### 新しいフォーマット
```
問題配列: 35問（7単元 × 5レベル）
配列方式: 螺旋マトリクス（Spiral Matrix）

Q1-7:   単元A～G の Level 1
Q8-14:  単元A～G の Level 2
Q15-21: 単元A～G の Level 3
Q22-28: 単元A～G の Level 4
Q29-35: 単元A～G の Level 5
```

### 適用対象
- **第1部：反射神経** - サバイバルテスト（セットA, B, C）
- **第2部：構造視力** - サバイバルテスト（セットA, B, C）
- **第3部：持久力・整理力** - サバイバルテスト（セットA, B, C）

---

## タスク1: 第1部「反射神経」の再構成

### 1-1. 7単元の定義

| 単元ID | 単元名 | 説明 |
|--------|--------|------|
| A | 神の数（小数↔分数） | 0.5, 0.25, 0.125, 0.375, 0.625, 0.875 など |
| B | 平方数（11の段～19の段） | 11×11=121, 12×12=144, ..., 19×19=361 |
| C | 3.14の段 | 3.14×2, 3.14×3, ..., 3.14×100 |
| D | 素数もどき | 87(3×29), 119(7×17), 143(11×13) など |
| E | 黄金ペア | 25×4=100, 125×8=1000, 16×625=10000 など |
| F | 補数 | 32+68=100, 375+625=1000, 1000-348=652 など |
| G | 瞬発暗算 | 9×56, 8×63, 7×84 など |

### 1-2. 各単元の難易度レベル（5段階）

#### 単元A: 神の数（小数↔分数）
- **Level 1**: 0.5 ↔ 1/2
- **Level 2**: 0.25 ↔ 1/4
- **Level 3**: 0.125 ↔ 1/8
- **Level 4**: 0.375 ↔ 3/8
- **Level 5**: 0.625, 0.875 ↔ 5/8, 7/8

#### 単元B: 平方数
- **Level 1**: 11×11, 12×12
- **Level 2**: 13×13, 14×14
- **Level 3**: 15×15, 16×16
- **Level 4**: 17×17, 18×18
- **Level 5**: 19×19

#### 単元C: 3.14の段
- **Level 1**: 3.14×2
- **Level 2**: 3.14×3
- **Level 3**: 3.14×4, 3.14×5
- **Level 4**: 3.14×10
- **Level 5**: 3.14×100

#### 単元D: 素数もどき
- **Level 1**: 87は素数か？（3×29）
- **Level 2**: 119は素数か？（7×17）
- **Level 3**: 143は素数か？（11×13）
- **Level 4**: 123は3の倍数か？（各位の和=6）
- **Level 5**: 123456789は9の倍数か？（各位の和=45）

#### 単元E: 黄金ペア
- **Level 1**: 25×4=100
- **Level 2**: 125×8=1000
- **Level 3**: 32×25=800
- **Level 4**: 16×625=10000
- **Level 5**: 125×32=4000

#### 単元F: 補数
- **Level 1**: 32+68=100
- **Level 2**: 375+625=1000
- **Level 3**: 1000-348=652
- **Level 4**: 10000-9999=1
- **Level 5**: 1-0.375=0.625

#### 単元G: 瞬発暗算
- **Level 1**: 7×8=56, 8×7=56
- **Level 2**: 9×6=54, 12×3=36
- **Level 3**: 6×15=90
- **Level 4**: 9×56=504
- **Level 5**: 8×63=504, 7×84=588

### 1-3. 螺旋マトリクス配列（セットA例）

```
Q1:  A-L1: 0.5 → □（分数）
Q2:  B-L1: 11 × 11
Q3:  C-L1: 3.14 × 2
Q4:  D-L1: 87 は素数か？
Q5:  E-L1: 25 × 4
Q6:  F-L1: 32 + 68
Q7:  G-L1: 7 × 8

Q8:  A-L2: 1/2 → □（小数）
Q9:  B-L2: 12 × 12
Q10: C-L2: 3.14 × 3
Q11: D-L2: 119 は素数か？
Q12: E-L2: 125 × 8
Q13: F-L2: 375 + 625
Q14: G-L2: 9 × 6

Q15: A-L3: 0.125 → □（分数）
Q16: B-L3: 13 × 13
Q17: C-L3: 3.14 × 4
Q18: D-L3: 143 は素数か？
Q19: E-L3: 32 × 25
Q20: F-L3: 1000 - 348
Q21: G-L3: 6 × 15

Q22: A-L4: 1/8 → □（小数）
Q23: B-L4: 14 × 14
Q24: C-L4: 3.14 × 10
Q25: D-L4: 123 は3の倍数か？
Q26: E-L4: 16 × 625
Q27: F-L4: 10000 - 9999
Q28: G-L4: 9 × 56

Q29: A-L5: 0.625 → □（分数）
Q30: B-L5: 15 × 15
Q31: C-L5: 3.14 × 100
Q32: D-L5: 123456789 は9の倍数か？
Q33: E-L5: 125 × 32
Q34: F-L5: 1 - 0.375
Q35: G-L5: 8 × 63
```

### 1-4. 実装ファイル
- **ファイル名**: `sec1_survival.js`
- **対象**: セットA, B, C すべてを再構成
- **変更箇所**:
  - `problems` 配列（30問 → 35問）
  - `answers` 配列（30個 → 35個）
  - `annotations` 配列（30個 → 35個）

---

## タスク2: 第2部「構造視力」の再構成

### 2-1. 7単元の定義

| 単元ID | 単元名 | 説明 |
|--------|--------|------|
| A | 分配法則（足し算） | 34×13+34×87 = 34×(13+87) |
| B | 分配法則（引き算） | 93×177-93×77 = 93×(177-77) |
| C | 分配法則（小数） | 1.7×3.7+8.3×3.7 |
| D | 補数（足して100） | 32+68, 96+104 |
| E | 補数（足して1000） | 234+766, 375+625 |
| F | 黄金ペア（×25, ×125, ×625） | 36×25=900, 64×125=8000 |
| G | 一発約分 | 24/36→2/3, 126/210→3/5 |

### 2-2. 難易度レベル（5段階）

各単元について、数字の大きさ・複雑さで5段階に分類。

#### 単元A: 分配法則（足し算）
- **Level 1**: 34×13+34×87 = 34×100 = 3400
- **Level 2**: 42×64+42×36 = 42×100 = 4200
- **Level 3**: 57×38+57×62 = 57×100 = 5700
- **Level 4**: 1.7×3.7+8.3×3.7 = 10×3.7 = 37
- **Level 5**: 3.14×12+3.14×23 = 3.14×35 = 109.9

#### 単元B: 分配法則（引き算）
- **Level 1**: 93×177-93×77 = 93×100 = 9300
- **Level 2**: 125×13-125×3 = 125×10 = 1250
- **Level 3**: 72×10.1-72×0.1 = 72×10 = 720
- **Level 4**: 56×105-56×5 = 56×100 = 5600
- **Level 5**: 2.4×6.8+7.6×6.8-（複雑なケース）

（以下、各単元のレベル分けを同様に定義）

### 2-3. 螺旋マトリクス配列（セットA例）

```
Q1:  A-L1: 34 × 13 + 34 × 87
Q2:  B-L1: 93 × 177 - 93 × 77
Q3:  C-L1: 1.7 × 3.7 + 8.3 × 3.7
Q4:  D-L1: 32 + 68
Q5:  E-L1: 375 + 625
Q6:  F-L1: 36 × 25
Q7:  G-L1: 24/36 を一発約分

（Q8-Q35: 同様に Level 2～5 を螺旋配列）
```

### 2-4. 実装ファイル
- **ファイル名**: `sec2_survival.js`
- **対象**: セットA, B, C すべてを再構成

---

## タスク3: 第3部「持久力・整理力」の再構成

### 3-1. 7単元の定義

| 単元ID | 単元名 | 説明 |
|--------|--------|------|
| A | 帯分数の処理 | 2(3/4)+1(1/2), 5-2(1/3) |
| B | 異分母分数（通分） | 1/3+1/4, 2/5+1/6 |
| C | 分数の乗算 | 2/3×3/4, 5/6×4/5 |
| D | 分数の除算 | 2/3÷3/4, (2/7)÷□=(5/21) |
| E | 小数と分数の混合 | 0.5+1/4, 6.625-4(2/3) |
| F | 逆算（□を求める） | □+2.5=7, (2/7)÷□=(5/21) |
| G | 複雑な四則 | (3.5-2.25)×(4+1/2) |

### 3-2. 難易度レベル（5段階）

各単元について、計算の複雑さで5段階に分類。

### 3-3. 螺旋マトリクス配列（セットA例）

```
Q1:  A-L1: 2(3/4) + 1(1/2)
Q2:  B-L1: 1/3 + 1/4
Q3:  C-L1: 2/3 × 3/4
Q4:  D-L1: 2/3 ÷ 3/4
Q5:  E-L1: 0.5 + 1/4
Q6:  F-L1: □ + 2.5 = 7
Q7:  G-L1: (3+1/2) × 2

（Q8-Q35: 同様に Level 2～5 を螺旋配列）
```

### 3-4. 実装ファイル
- **ファイル名**: `sec3_survival.js`
- **対象**: セットA, B, C すべてを再構成

---

## タスク4: CSS・レイアウトの調整

### 4-1. 35問対応レイアウト
- **現状**: 30問を2列で表示（15問×2列）
- **変更後**: 35問を2列で表示（18問 + 17問）

### 4-2. CSSクラスの調整
- `.survival-sheet` クラスの列数・高さ調整
- 問題番号の表示（1～35）

### 4-3. 実装ファイル
- **ファイル名**: `style.css`
- **変更箇所**:
  - `.survival-sheet .problems` の `column-count`, `column-gap`
  - `.problem-item` の `height`, `margin`

---

## タスク5: UIテキストの更新

### 5-1. 制限時間の変更
- **現状**: "制限時間3分"
- **変更後**: "制限時間4分"（35問に増加したため）

### 5-2. method説明文の更新
- **現状**: "難易度順30問。1問でも間違えたらそこで終了"
- **変更後**: "インターリーブ配列35問（7単元×5レベル）。1問でも間違えたらそこで終了"

### 5-3. 実装ファイル
- `sec1_survival.js`, `sec2_survival.js`, `sec3_survival.js` の `method` フィールド

---

## タスク6: annotations（解説）の再構成

### 6-1. 単元ごとの解説パターン
- **現状**: 各問題に「壁①」「壁②」「壁③」のラベル
- **変更後**: 単元名を明示（例: "【神の数】0.5=1/2。即答できるまで繰り返せ。"）

### 6-2. インターリーブ効果の説明追加
- 解説ページに「なぜ単元を混ぜているか？」の説明を追加（オプション）

---

## タスク7: テスト・検証

### 7-1. 動作確認
- [ ] ブラウザで各セット（A, B, C）を表示
- [ ] 問題数が35問になっていることを確認
- [ ] 問題の順序がインターリーブ配列になっていることを確認
- [ ] レイアウトが崩れていないことを確認

### 7-2. 教育効果の確認
- [ ] 単元の並びが適切か（A→B→C→...→G→A→B→...）
- [ ] 難易度が適切に上昇しているか（Level 1→5）
- [ ] 解説が分かりやすいか

### 7-3. パフォーマンステスト
- [ ] MathJax のレンダリング速度（35問でも問題ないか）
- [ ] 印刷時のレイアウト（2ページに収まるか）

---

## 実装の優先順位

### フェーズ1: 第1部の再構成（最優先）
1. 7単元の問題リストを作成
2. 螺旋マトリクス配列でセットA, B, C を再構成
3. `sec1_survival.js` を更新
4. 動作確認・テスト

### フェーズ2: 第2部の再構成
1. 7単元の問題リストを作成
2. 螺旋マトリクス配列でセットA, B, C を再構成
3. `sec2_survival.js` を更新
4. 動作確認・テスト

### フェーズ3: 第3部の再構成
1. 7単元の問題リストを作成
2. 螺旋マトリクス配列でセットA, B, C を再構成
3. `sec3_survival.js` を更新
4. 動作確認・テスト

### フェーズ4: CSS・UI調整
1. 35問対応レイアウト調整
2. 制限時間・説明文の更新
3. 解説の再構成

### フェーズ5: 総合テスト
1. すべてのセット・部を通しテスト
2. 印刷・PDF出力の確認
3. ユーザーテスト（生徒に実際に解いてもらう）

---

## 注意事項

### 1. 既存の訓練（Training）セクションは変更しない
- このタスクは「サバイバルテスト」のみを対象とする
- `sec1_reflexes.js`, `sec1b_factors.js`, `sec2_structure.js`, `sec2b_gcd.js`, `sec3_endurance.js`, `sec3_audit.js` は変更しない

### 2. セットA, B, C の独立性を保つ
- 各セットは独立したテスト（異なる数値）
- 単元構成・難易度構造は3セット共通

### 3. Git コミットは小さく分割
- 各フェーズごとにコミット
- コミットメッセージ例:
  - "Refactor: 第1部サバイバルテストをインターリーブ配列（35問）に再構成"
  - "Refactor: 第2部サバイバルテストをインターリーブ配列（35問）に再構成"

---

## 参考資料

### Interleaving Effect（インターリーブ効果）
- **文献**: Rohrer, D., & Taylor, K. (2007). The shuffling of mathematics problems improves learning. *Instructional Science*, 35(6), 481-498.
- **要点**: ブロック学習よりもインターリーブ学習の方が、長期記憶と問題識別能力が向上する。

### Psychometrics（心理測定学）
- **天井効果**: テストが簡単すぎて、多くの受験者が満点近くを取ってしまい、真の能力差が測れない現象。
- **解決策**: 問題数を増やし、難易度の幅を広げることで、より細かい習熟度判定が可能になる。

---

## 完了条件

✅ 第1部、第2部、第3部すべてのサバイバルテストが35問のインターリーブ配列に再構成されている
✅ セットA, B, C すべてに適用されている
✅ CSSレイアウトが35問に対応している
✅ 制限時間・説明文が更新されている
✅ すべてのテストが正常に動作し、印刷・PDF出力も問題ない
✅ Git コミット・プッシュが完了している

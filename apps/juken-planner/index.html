<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YV5WWWG39Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-YV5WWWG39Z');
    </script>

    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PRPCBPS2');</script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¥è©¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ (å—é¨“ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼) | æ¡œã‚¢ã‚«ãƒ‡ãƒŸã‚¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="school_data.js"></script>

    <style>
        :root {
            --primary-color: #37474f;
            --accent-blue: #0288d1;
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --border-color: #e0e0e0;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            overflow: hidden;
            color: #333;
        }

        /* === ãƒ˜ãƒƒãƒ€ãƒ¼ === */
        #header-area {
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .home-link {
            text-decoration: none;
            font-size: 18px;
            margin-right: 5px;
        }

        .app-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            white-space: nowrap;
        }

        .my-ss-area {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #fff3e0;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #ffe0b2;
        }

        .my-ss-label {
            font-size: 11px;
            font-weight: bold;
            color: #e65100;
        }

        .my-ss-input {
            width: 50px;
            padding: 3px;
            border: 1px solid #ffcc80;
            border-radius: 3px;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
            color: #e65100;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn {
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .btn-help {
            background: #607d8b;
            color: white;
            border-radius: 20px;
        }

        .btn-help:hover {
            background: #455a64;
        }

        .btn-x {
            background: #000;
            color: #fff;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-x:hover {
            opacity: 0.8;
        }

        .btn-save {
            background: #00897b;
            color: white;
        }

        .btn-save:hover {
            background: #00695c;
        }

        .btn-load {
            background: #00897b;
            color: white;
            border: 1px solid #00695c;
        }

        .btn-load:hover {
            background: #00695c;
        }

        .btn-reset {
            background: #fff;
            border: 1px solid #d32f2f;
            color: #d32f2f;
        }

        .btn-reset:hover {
            background: #ffebee;
        }

        .btn-print {
            background: var(--primary-color);
            color: #fff;
        }

        .btn-print:hover {
            background: #263238;
        }

        /* ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            width: 650px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #888;
        }

        .help-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }

        .help-section:last-child {
            border-bottom: none;
        }

        .help-h3 {
            color: #0277bd;
            font-size: 16px;
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .help-p {
            font-size: 13px;
            color: #444;
            line-height: 1.6;
            margin: 0 0 8px 0;
        }

        .help-note {
            background: #f1f8e9;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #33691e;
        }

        .help-icon {
            font-size: 18px;
        }

        /* === ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ === */
        #main-container {
            display: flex;
            height: calc(100% - 60px);
            padding: 10px;
            gap: 10px;
        }

        #stock-panel {
            width: 260px;
            flex-shrink: 0;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        #stock-controls {
            padding: 10px;
            background: #fff;
            border-bottom: 1px dashed #ddd;
            display: flex;
            gap: 8px;
            flex-direction: column;
        }

        .control-row {
            display: flex;
            gap: 5px;
        }

        .select-wrapper {
            flex: 1;
        }

        .select-wrapper select {
            width: 100%;
            padding: 6px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f9f9f9;
            font-weight: bold;
            color: #444;
            cursor: pointer;
        }

        .panel-header {
            padding: 8px;
            background: #eee;
            border-bottom: 1px solid #ddd;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            color: #555;
            display: flex;
        }

        .ph-col {
            flex: 1;
        }

        #stock-lists {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .stock-column {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            background: #fafafa;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .stock-column:last-child {
            border-right: none;
        }

        .idx-header {
            font-size: 10px;
            font-weight: bold;
            color: #999;
            margin: 8px 0 2px 0;
            border-bottom: 1px solid #eee;
        }

        .blank-card-source {
            border: 2px dashed #ccc;
            background: #fff;
            color: #777;
            font-weight: bold;
            text-align: center;
            padding: 8px;
            cursor: grab;
            margin-bottom: 10px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .blank-card-source:hover {
            border-color: #999;
            background: #f9f9f9;
        }

        .blank-card-source.type-boy {
            border-color: #90caf9;
            color: #1976d2;
            background: #e3f2fd;
        }

        .blank-card-source.type-girl {
            border-color: #ef9a9a;
            color: #d32f2f;
            background: #ffebee;
        }

        .blank-card-source.type-coed {
            border-color: #a5d6a7;
            color: #388e3c;
            background: #e8f5e9;
        }

        #calendar-wrapper {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        #row-headers {
            width: 35px;
            flex-shrink: 0;
            border-right: 1px solid #ddd;
            background: #fcfcfc;
            z-index: 10;
            display: flex;
            flex-direction: column;
            padding-top: 36px;
        }

        .row-label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 12px;
            font-weight: bold;
            color: #888;
            letter-spacing: 2px;
            border-bottom: 1px dashed #999;
            user-select: none;
        }

        .row-label:last-child {
            border-bottom: none;
        }

        #calendar-scroll {
            flex: 1;
            overflow-x: auto;
            overflow-y: hidden;
            display: flex;
        }

        .day-column {
            width: 170px;
            min-width: 170px;
            flex-shrink: 0;
            border-right: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .day-column.new-day {
            border-left: 2px solid #999;
        }

        .day-header {
            height: 36px;
            line-height: 36px;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            color: #fff;
            background: #546e7a;
            border-bottom: 1px solid #37474f;
            flex-shrink: 0;
        }

        .day-header.pm {
            background: #78909c;
        }

        .day-header.jan {
            background: #00838f;
        }

        .day-header.late {
            background: #e65100;
        }

        .slot-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .slot {
            flex: 1;
            border-bottom: 1px dashed #999;
            padding: 6px;
            overflow-y: auto;
            overflow-x: hidden;
            transition: background 0.2s;
            display: flex;
            flex-direction: column;
            gap: 6px;
            position: relative;
        }

        .slot:last-child {
            border-bottom: none;
        }

        .slot.top {
            background: rgba(255, 255, 255, 0.5);
        }

        .slot.mid {
            background: rgba(250, 250, 250, 0.5);
        }

        .slot.low {
            background: rgba(245, 245, 245, 0.5);
        }

        .card {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: grab;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border-left-width: 5px;
            color: #333;
            user-select: none;
        }

        .type-boy {
            border-left-color: #2196f3;
        }

        .type-girl {
            border-left-color: #e91e63;
        }

        .type-coed {
            border-left-color: #4caf50;
        }

        .card.in-calendar {
            border-left-width: 1px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 6px;
            min-height: 85px;
            gap: 4px;
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }

        .card.in-calendar.type-boy {
            border-top: 4px solid #2196f3;
        }

        .card.in-calendar.type-girl {
            border-top: 4px solid #e91e63;
        }

        .card.in-calendar.type-coed {
            border-top: 4px solid #4caf50;
        }

        .school-name-large {
            font-size: 14px;
            font-weight: 900;
            color: #222;
            display: block;
            line-height: 1.2;
            word-break: break-all;
        }

        .card-data-row {
            display: flex;
            gap: 5px;
            align-items: center;
            width: 100%;
        }

        .input-ss {
            width: 40px;
            padding: 2px;
            font-size: 11px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
            flex-shrink: 0;
        }

        .input-subj {
            flex: 1;
            min-width: 0;
            padding: 2px;
            font-size: 11px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .free-input {
            width: 100%;
            padding: 4px;
            font-size: 11px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background: #f9f9f9;
        }

        .free-input:focus,
        .input-ss:focus,
        .input-subj:focus {
            background: #fff;
            border-color: var(--accent-blue);
            outline: none;
        }

        .name-input {
            width: 100%;
            font-size: 13px;
            font-weight: bold;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 2px;
            margin-bottom: 2px;
        }

        .judgment-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            color: #fff;
            display: none;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .badge-challenge {
            background: #ff5722;
            display: inline-block;
        }

        .badge-safe {
            background: #2196f3;
            display: inline-block;
        }

        .badge-proper {
            background: #4caf50;
            display: inline-block;
        }

        .sortable-ghost {
            opacity: 0.4;
            background: #bdbdbd;
        }

        .sortable-drag {
            opacity: 1;
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        #print-title {
            display: none;
        }

        @media print {
            @page {
                size: A3 landscape;
                margin: 5mm;
            }

            body {
                background: #fff;
                overflow: visible;
                -webkit-print-color-adjust: exact;
            }

            #header-area,
            #stock-panel {
                display: none !important;
            }

            #print-title {
                display: block;
                text-align: center;
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
                border-bottom: 2px solid #333;
            }

            #main-container {
                height: auto;
                padding: 0;
                display: block;
            }

            #calendar-wrapper {
                border: none;
                box-shadow: none;
                display: flex;
                width: 100%;
                overflow: visible;
            }

            #row-headers {
                display: flex !important;
                height: auto;
                border-right: 2px solid #000;
                padding-top: 30px;
            }

            .row-label {
                height: 250px;
                border-bottom: 1px solid #000;
                color: #000;
                flex: none;
            }

            #calendar-scroll {
                overflow: visible;
                display: flex;
                flex-wrap: wrap;
            }

            .day-column {
                flex: 1;
                min-width: 120px;
                width: auto;
                border: 1px solid #000;
                margin-bottom: -1px;
                margin-right: -1px;
                page-break-inside: avoid;
            }

            .day-header {
                background: #ccc !important;
                color: #000 !important;
                border-bottom: 1px solid #000;
                font-size: 11px;
                height: 30px;
                line-height: 30px;
            }

            .slot {
                height: 250px;
                border-bottom: 1px solid #000;
                padding: 2px;
                flex: none;
            }

            .card.in-calendar {
                border: 1px solid #000;
                box-shadow: none;
                margin-bottom: 4px;
                min-height: 80px;
            }

            input {
                border: none;
                background: transparent;
                padding: 0;
                font-weight: bold;
                -webkit-appearance: none;
            }

            .free-input {
                font-size: 11px;
            }

            .input-ss {
                text-align: left;
                width: auto;
            }

            ::placeholder {
                color: transparent;
            }

            .judgment-badge {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PRPCBPS2" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>

    <div id="print-title">
        å…¥è©¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ <span id="print-ss-display" style="font-size:16px; margin-left:20px; font-weight:normal;"></span>
    </div>

    <div id="help-modal" role="dialog" aria-modal="true" onclick="if(event.target == this) App.toggleHelp()">
        <div class="modal-content">
            <button type="button" class="close-modal" aria-label="ã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã‚‹" onclick="App.toggleHelp()">Ã—</button>
            <h2 style="margin-top:0; border-bottom:2px solid #ddd; padding-bottom:10px;">ğŸ”° ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>

            <div class="help-section">
                <h3 class="help-h3"><span class="help-icon">ğŸ‘†</span> åŸºæœ¬æ“ä½œ</h3>
                <p class="help-p">å·¦å´ã®ãƒªã‚¹ãƒˆã‹ã‚‰å¿—æœ›æ ¡ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€å³å´ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆæ—¥ç¨‹æ ï¼‰ã¸ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚<br>å­¦æ ¡ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€ãƒªã‚¹ãƒˆä¸€ç•ªä¸Šã®ã€Œâœ è‡ªç”±å…¥åŠ›ã€ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ãˆã¾ã™ã€‚
                </p>
            </div>

            <div class="help-section">
                <h3 class="help-h3"><span class="help-icon">ğŸ“</span> ãƒ‡ãƒ¼ã‚¿ã®å…¥åŠ›</h3>
                <p class="help-p">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å…¥ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã«ã¯ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’ç›´æ¥æ›¸ãè¾¼ã‚ã¾ã™ã€‚</p>
                <ul style="font-size:13px; color:#444; margin:5px 0 10px 20px;">
                    <li><b>SS</b>ï¼šåå·®å€¤ï¼ˆæ•°å­—ã‚’å…¥ã‚Œã‚‹ã¨è‡ªå‹•åˆ¤å®šã•ã‚Œã¾ã™ï¼‰</li>
                    <li><b>ç§‘ç›®</b>ï¼š4ç§‘ã€2ç§‘ã€ç®—æ•°ãªã©ï¼ˆæ‰‹å…¥åŠ›ã‚‚å¯èƒ½ï¼‰</li>
                    <li><b>å‚™è€ƒ</b>ï¼šå…¥è©¦å›ï¼ˆç¬¬1å›ãªã©ï¼‰ã‚„ç‰¹å¾…ã€åˆå¾Œå…¥è©¦ãªã©ã®ãƒ¡ãƒ¢</li>
                </ul>
                <div class="help-note">ğŸ’¡ ã€ŒæŒã¡åå·®å€¤ã€ã‚’å…¥åŠ›ã—ã¦ãŠãã¨ã€å­¦æ ¡SSã¨ã®å·®åˆ†ã§ã€ŒğŸŸ¥æŒ‘æˆ¦ã€ã€ŒğŸŸ¦å®‰å…¨ã€ã€ŒğŸŸ©é©æ­£ã€ã®ãƒãƒƒã‚¸ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
            </div>

            <div class="help-section">
                <h3 class="help-h3"><span class="help-icon">ğŸ’¾</span> ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«ã¤ã„ã¦</h3>
                <p class="help-p"><b>â‘  è‡ªå‹•ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰</b><br>æ“ä½œã™ã‚‹ãŸã³ã«ã€ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚ç”»é¢ã‚’é–‰ã˜ã¦ã‚‚ç¶šãã‹ã‚‰å†é–‹ã§ãã¾ã™ã€‚</p>
                <p class="help-p"><b>â‘¡ ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</b><br>ã€ŒğŸ’¾ ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ä½œæˆã—ãŸãƒ—ãƒ©ãƒ³ã‚’ <code>å…¥è©¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«.json</code>
                    ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ‘ã‚½ã‚³ãƒ³ã«ä¿å­˜ã§ãã¾ã™ã€‚</p>
                <p class="help-p"><b>â‘¢ ãƒ‡ãƒ¼ã‚¿ã®èª­è¾¼</b><br>ã€ŒğŸ“‚ èª­è¾¼ã€ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã¨ã€ä»¥å‰ã®ãƒ—ãƒ©ãƒ³ã‚’å¾©å…ƒã§ãã¾ã™ã€‚</p>
            </div>

            <div style="text-align:center; margin-top:20px;">
                <button type="button" class="btn btn-print" onclick="App.toggleHelp()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="header-area">
        <div class="header-left">
            <a href="../index.html" class="home-link" aria-label="ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹">ğŸ </a>
            <div class="app-title">ğŸ“… å—é¨“ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</div>
            <div class="my-ss-area">
                <label for="header-ss-input" class="my-ss-label">æŒã¡åå·®å€¤:</label>
                <input type="number" id="header-ss-input" class="my-ss-input" placeholder="--"
                    oninput="App.updateAllJudgments(); App.saveData();"
                    onchange="document.getElementById('print-ss-display').innerText = this.value ? '(æŒã¡åå·®å€¤: ' + this.value + ')' : ''">
            </div>
        </div>
        <div class="header-actions">
            <button type="button" class="btn btn-help" onclick="App.toggleHelp()">â“ ä½¿ã„æ–¹</button>
            <a href="https://x.com/Sakura_Academia" target="_blank" class="btn-x">ğ• ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</a>

            <div class="btn-group" style="margin-left:10px; border-left:1px solid #ccc; padding-left:10px;">
                <button type="button" class="btn btn-save" onclick="App.downloadJSON()">ğŸ’¾ ä¿å­˜</button>
                <input type="file" id="file-input" style="display:none" accept=".json" onchange="App.uploadJSON(this)">
                <button type="button" class="btn btn-load" onclick="document.getElementById('file-input').click()">ğŸ“‚
                    èª­è¾¼</button>
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-reset" onclick="App.resetCalendar()">å…¨æ¶ˆå»</button>
                <button type="button" class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>
            </div>
        </div>
    </div>

    <div id="main-container">
        <div id="stock-panel">
            <div id="stock-controls">
                <div class="control-row">
                    <div class="select-wrapper">
                        <select id="gender-select" aria-label="å—é¨“æ€§åˆ¥é¸æŠ">
                            <option value="boy">ğŸ‘¦ ç”·å­å—é¨“</option>
                            <option value="girl">ğŸ‘§ å¥³å­å—é¨“</option>
                        </select>
                    </div>
                    <div class="select-wrapper">
                        <select id="region-select" aria-label="å—é¨“åœ°åŸŸãƒ»æ™‚æœŸé¸æŠ">
                            <option value="feb" selected>ğŸ—¼ 2æœˆæ ¡</option>
                            <option value="jan">ğŸ 1æœˆæ ¡</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="panel-header">
                <div class="ph-col" id="header-gender-label">ç”·å­æ ¡</div>
                <div class="ph-col">å…±å­¦æ ¡</div>
            </div>
            <div id="stock-lists">
                <div id="stock-gender" class="stock-column"></div>
                <div id="stock-coed" class="stock-column"></div>
            </div>
        </div>
        <div id="calendar-wrapper">
            <div id="row-headers">
                <div class="row-label">ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
                <div class="row-label">å®ŸåŠ›ç›¸å¿œ</div>
                <div class="row-label">å®‰å…¨åœ</div>
            </div>
            <div id="calendar-scroll"></div>
        </div>
    </div>

    <datalist id="subj-list">
        <option value="4ç§‘"></option>
        <option value="2ç§‘"></option>
        <option value="ç®—æ•°"></option>
        <option value="å›½èª"></option>
        <option value="è‹±èª"></option>
        <option value="é©æ€§"></option>
        <option value="1ç§‘"></option>
        <option value="ä½œæ–‡"></option>
    </datalist>

    <script>
        const CALENDAR_DEF = [
            { id: "jan_early", label: "1æœˆ å‰åŠ", type: "jan", newDay: true },
            { id: "jan_late", label: "1æœˆ å¾ŒåŠ", type: "jan", newDay: false },
            { id: "feb1_am", label: "2/1 AM", type: "am", newDay: true }, { id: "feb1_pm", label: "2/1 PM", type: "pm", newDay: false },
            { id: "feb2_am", label: "2/2 AM", type: "am", newDay: true }, { id: "feb2_pm", label: "2/2 PM", type: "pm", newDay: false },
            { id: "feb3_am", label: "2/3 AM", type: "am", newDay: true }, { id: "feb3_pm", label: "2/3 PM", type: "pm", newDay: false },
            { id: "feb4_am", label: "2/4 AM", type: "am", newDay: true }, { id: "feb4_pm", label: "2/4 PM", type: "pm", newDay: false },
            { id: "feb5", label: "2/5", type: "am", newDay: true }, { id: "feb6_etc", label: "2/6ä»¥é™", type: "late", newDay: true }
        ];

        const App = {
            data: [],
            escapeHTML: function (str) {
                if (!str) return "";
                return str.replace(/[&<>"']/g, function (m) {
                    return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m];
                });
            },

            init: function () {
                if (window.SCHOOL_DATA && Array.isArray(window.SCHOOL_DATA)) {
                    this.data = window.SCHOOL_DATA;
                }
                else {
                    const errorMsg = "ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã€‘\nschool_data.jsãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€ä¸­èº«ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\n\n1. index.htmlã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« school_data.js ãŒã‚ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n2. school_data.jsã®1è¡Œç›®ãŒ window.SCHOOL_DATA = [...]; ã§å§‹ã¾ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
                    alert(errorMsg);
                    console.error("SCHOOL_DATA is not defined. Please check school_data.js path and content.");
                    return;
                }
                this.renderCalendar(); this.bindEvents(); this.refreshStock();
                setTimeout(() => { this.loadData(); }, 100);
            },
            bindEvents: function () {
                document.getElementById('gender-select').addEventListener('change', () => this.refreshStock());
                document.getElementById('region-select').addEventListener('change', () => this.refreshStock());
            },
            toggleHelp: function () {
                const el = document.getElementById('help-modal');
                el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
            },
            renderCalendar: function () {
                const area = document.getElementById('calendar-scroll');
                area.innerHTML = "";
                CALENDAR_DEF.forEach(col => {
                    const wrapper = document.createElement('div');
                    wrapper.className = `day-column${col.newDay ? ' new-day' : ''}`;
                    wrapper.innerHTML = `<div class="day-header ${col.type}">${col.label}</div><div class="slot-container"><div class="slot top" data-slot-id="${col.id}"></div><div class="slot mid" data-slot-id="${col.id}"></div><div class="slot low" data-slot-id="${col.id}"></div></div>`;
                    area.appendChild(wrapper);
                });
                document.querySelectorAll('.slot').forEach(slot => {
                    new Sortable(slot, {
                        group: 'schools', animation: 150, ghostClass: 'sortable-ghost', dragClass: 'sortable-drag',
                        onAdd: (evt) => {
                            const item = evt.item;
                            if (item.classList.contains('in-calendar')) {
                                const currentData = {
                                    name: item.querySelector('.name-input') ? item.querySelector('.name-input').value : item.querySelector('.school-name-large').innerText,
                                    ss: item.querySelector('.input-ss').value,
                                    subj: item.querySelector('.input-subj').value,
                                    memo: item.querySelector('.free-input').value
                                };
                                this.transformToCalendarCard(item, currentData);
                            } else {
                                this.transformToCalendarCard(item);
                            }
                            this.sortSlot(evt.to);
                            this.saveData();
                        },
                        onEnd: () => { this.saveData(); }
                    });
                });
            },
            refreshStock: function () {
                const gender = document.getElementById('gender-select').value;
                const region = document.getElementById('region-select').value;
                const containerG = document.getElementById('stock-gender');
                const containerC = document.getElementById('stock-coed');
                containerG.innerHTML = ""; containerC.innerHTML = "";
                document.getElementById('header-gender-label').innerText = (gender === 'boy') ? "ç”·å­æ ¡" : "å¥³å­æ ¡";
                const filtered = this.data.filter(s => s.region === region);
                filtered.sort((a, b) => a.kana.localeCompare(b.kana, 'ja'));
                const genderList = filtered.filter(s => (gender === 'boy' && s.type === 'boy') || (gender === 'girl' && s.type === 'girl'));
                const coedList = filtered.filter(s => s.type === 'coed');
                this.fillStockColumn(containerG, genderList, (gender === 'boy' ? 'boy' : 'girl'));
                this.fillStockColumn(containerC, coedList, 'coed');
            },
            fillStockColumn: function (container, list, typeForBlank) {
                const blank = document.createElement('div');
                blank.className = `blank-card-source type-${typeForBlank}`;
                blank.setAttribute('data-id', `custom_${typeForBlank}`);
                blank.innerHTML = '<span>âœ è‡ªç”±å…¥åŠ›</span>';
                container.appendChild(blank);

                let lastIndex = "";
                list.forEach(school => {
                    const idx = this.getIndexChar(school.kana);
                    if (idx !== lastIndex) {
                        const header = document.createElement('div'); header.className = 'idx-header'; header.innerText = idx;
                        container.appendChild(header); lastIndex = idx;
                    }
                    const card = document.createElement('div');
                    card.className = `card type-${school.type}`; card.setAttribute('data-id', school.id); card.innerText = school.name;
                    container.appendChild(card);
                });
                new Sortable(container, {
                    group: { name: 'schools', pull: 'clone', put: true },
                    sort: false, animation: 150, filter: ".idx-header",
                    onMove: (evt) => {
                        if (evt.from === evt.to) return false;
                        if (evt.to.classList.contains('stock-column') && evt.from.classList.contains('stock-column')) return false;
                    },
                    onAdd: (evt) => { evt.item.parentNode.removeChild(evt.item); }
                });
            },

            transformToCalendarCard: function (el, restoreData = null) {
                const id = el.getAttribute('data-id');
                let schoolName = "";
                let typeClass = "";
                let isCustom = false;

                if (id && id.startsWith('custom_')) {
                    isCustom = true;
                    let typeSuffix = id.replace('custom_', '');
                    typeClass = `type-${typeSuffix}`;
                } else {
                    const school = this.data.find(s => s.id === id);
                    schoolName = school ? school.name : "ä¸æ˜";
                    typeClass = `type-${school ? school.type : 'coed'}`;
                }

                el.className = `card in-calendar ${typeClass}`;

                let nameVal = restoreData ? this.escapeHTML(restoreData.name) : "";
                let ssVal = restoreData ? this.escapeHTML(restoreData.ss) : "";
                let subjVal = restoreData ? this.escapeHTML(restoreData.subj) : "";
                let memoVal = restoreData ? this.escapeHTML(restoreData.memo) : "";

                if (!restoreData && !isCustom) { nameVal = this.escapeHTML(schoolName); }

                let nameHtml = isCustom
                    ? `<input type="text" class="name-input" aria-label="å­¦æ ¡åå…¥åŠ›" placeholder="å­¦æ ¡å" value="${nameVal}" onmousedown="event.stopPropagation()" oninput="App.saveData()">`
                    : `<div><span class="school-name-large">${this.escapeHTML(schoolName)}</span></div>`;

                el.innerHTML = `
            ${nameHtml}
            <span class="judgment-badge"></span>
            <div class="card-data-row">
                <input type="number" class="input-ss" aria-label="åå·®å€¤" placeholder="SS" value="${ssVal}" onmousedown="event.stopPropagation()" oninput="App.updateJudgment(this.closest('.card')); App.saveData();">
                <input type="text" class="input-subj" aria-label="å…¥è©¦ç§‘ç›®" list="subj-list" placeholder="ç§‘ç›®" value="${subjVal}" onmousedown="event.stopPropagation()" oninput="App.saveData()">
            </div>
            <input type="text" class="free-input" aria-label="å‚™è€ƒãƒ»ãƒ¡ãƒ¢" placeholder="å‚™è€ƒ" value="${memoVal}" onmousedown="event.stopPropagation()" oninput="App.saveData()">
        `;

                if (ssVal) this.updateJudgment(el);
            },

            updateJudgment: function (card) {
                const mySS = parseFloat(document.getElementById('header-ss-input').value);
                const schoolSS = parseFloat(card.querySelector('.input-ss').value);
                const badge = card.querySelector('.judgment-badge');

                if (!mySS || !schoolSS) {
                    badge.style.display = 'none';
                    return;
                }

                const diff = schoolSS - mySS;
                badge.style.display = 'inline-block';
                badge.className = 'judgment-badge';

                if (diff >= 5) {
                    badge.innerText = "æŒ‘æˆ¦";
                    badge.classList.add('badge-challenge');
                } else if (diff <= -5) {
                    badge.innerText = "å®‰å…¨";
                    badge.classList.add('badge-safe');
                } else {
                    badge.innerText = "é©æ­£";
                    badge.classList.add('badge-proper');
                }
            },

            updateAllJudgments: function () {
                document.querySelectorAll('.card.in-calendar').forEach(card => {
                    this.updateJudgment(card);
                });
            },

            sortSlot: function (container) { Array.from(container.children).forEach(item => container.appendChild(item)); },
            getIndexChar: function (kana) {
                if (!kana) return "ä»–"; const c = kana.charAt(0);
                if (/[ã‚-ãŠ]/.test(c)) return "ã‚è¡Œ"; if (/[ã‹-ã“]/.test(c)) return "ã‹è¡Œ"; if (/[ã•-ã]/.test(c)) return "ã•è¡Œ";
                if (/[ãŸ-ã¨]/.test(c)) return "ãŸè¡Œ"; if (/[ãª-ã®]/.test(c)) return "ãªè¡Œ"; if (/[ã¯-ã»]/.test(c)) return "ã¯è¡Œ";
                if (/[ã¾-ã‚‚]/.test(c)) return "ã¾è¡Œ"; if (/[ã‚„-ã‚ˆ]/.test(c)) return "ã‚„è¡Œ"; if (/[ã‚‰-ã‚]/.test(c)) return "ã‚‰è¡Œ";
                if (/[ã‚-ã‚“]/.test(c)) return "ã‚è¡Œ"; return "ä»–";
            },
            resetCalendar: function () {
                if (confirm('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å…¨ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                    document.querySelectorAll('.slot').forEach(s => s.innerHTML = "");
                    document.getElementById('header-ss-input').value = "";
                    this.saveData();
                }
            },

            saveData: function () {
                const data = {
                    mySS: document.getElementById('header-ss-input').value,
                    slots: {}
                };
                document.querySelectorAll('.slot').forEach(slot => {
                    const uniqueId = slot.getAttribute('data-slot-id') + "_" + (slot.classList.contains('top') ? 'top' : slot.classList.contains('mid') ? 'mid' : 'low');
                    const cards = [];
                    slot.querySelectorAll('.card').forEach(c => {
                        cards.push({
                            id: c.getAttribute('data-id'),
                            name: c.querySelector('.name-input') ? c.querySelector('.name-input').value : c.querySelector('.school-name-large').innerText,
                            ss: c.querySelector('.input-ss').value,
                            subj: c.querySelector('.input-subj').value,
                            memo: c.querySelector('.free-input').value
                        });
                    });
                    data.slots[uniqueId] = cards;
                });
                localStorage.setItem('sakura_plan_data', JSON.stringify(data));
            },

            loadData: function () {
                const json = localStorage.getItem('sakura_plan_data');
                if (!json) return;
                try {
                    this.restoreFromJSON(JSON.parse(json));
                } catch (e) { console.error("Data load failed", e); }
            },

            restoreFromJSON: function (data) {
                if (!data) return;
                document.getElementById('header-ss-input').value = this.escapeHTML(data.mySS) || "";
                document.getElementById('print-ss-display').innerText = data.mySS ? '(æŒã¡åå·®å€¤: ' + this.escapeHTML(data.mySS) + ')' : "";

                document.querySelectorAll('.slot').forEach(s => s.innerHTML = "");

                for (const [uniqueId, cards] of Object.entries(data.slots)) {
                    const parts = uniqueId.lastIndexOf('_');
                    if (parts === -1) continue;
                    const slotId = uniqueId.substring(0, parts);
                    const pos = uniqueId.substring(parts + 1);

                    const targetSlot = document.querySelector(`.slot.${pos}[data-slot-id="${slotId}"]`);
                    if (targetSlot) {
                        cards.forEach(cData => {
                            const div = document.createElement('div');
                            div.setAttribute('data-id', this.escapeHTML(cData.id));
                            targetSlot.appendChild(div);
                            this.transformToCalendarCard(div, cData);
                        });
                    }
                }
                this.updateAllJudgments();
            },

            downloadJSON: function () {
                this.saveData();
                const json = localStorage.getItem('sakura_plan_data');
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'å…¥è©¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«.json';
                a.click();
                URL.revokeObjectURL(url);
            },

            uploadJSON: function (input) {
                const file = input.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        this.restoreFromJSON(data);
                        this.saveData();
                        alert("ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ");
                    } catch (e) {
                        alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
                    }
                };
                reader.readAsText(file);
                input.value = "";
            }
        };
        window.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YV5WWWG39Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-YV5WWWG39Z');
  </script>

  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PRPCBPS2');</script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç«‹ä½“å›³å½¢ã‚¹ãƒ©ã‚¤ã‚µãƒ¼ | æ¡œã‚¢ã‚«ãƒ‡ãƒŸã‚¢</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <style>
    :root {
      --primary-navy: #1a2a44;
      --accent-sakura: #ffcae0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      overflow: hidden;
      background-color: #fdfcf5;
      font-family: "Helvetica Neue", Arial, sans-serif;
    }

    /* ===== æœ€ä¸Šéƒ¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ ===== */
    #app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 44px;
      background: var(--primary-navy);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      z-index: 120;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    #app-header h1 {
      font-size: 16px;
      margin: 0;
      letter-spacing: 0.05em;
      font-weight: bold;
    }

    .btn-home {
      color: white;
      text-decoration: none;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: bold;
    }

    .btn-home span {
      font-size: 12px;
    }

    /* ===== ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
    #top-nav {
      position: fixed;
      top: 44px;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.98);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      padding: 8px 12px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-tab {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: bold;
      color: #555;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: 0.2s;
      white-space: nowrap;
    }

    .nav-tab:hover {
      background: #e8e8e8;
    }

    .nav-tab.active {
      background: #3949ab;
      border-color: #283593;
      color: white;
      box-shadow: 0 0 5px rgba(57, 73, 171, 0.4);
    }

    .nav-tab::after {
      content: 'â–¼';
      font-size: 10px;
      opacity: 0.6;
    }

    .dropdown-panel {
      display: none;
      position: fixed;
      /* absoluteã‹ã‚‰å¤‰æ›´ */
      top: 50px;
      left: 10px;
      margin-top: 4px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 12px;
      min-width: 320px;
      max-height: 75vh;
      overflow-y: auto;
      z-index: 200;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ */
    .stepper-wrapper {
      display: flex;
      align-items: center;
      gap: 5px;
      width: 100%;
    }

    .stepper-btn {
      background: #ddd;
      border: 1px solid #ccc;
      color: #333;
      font-weight: bold;
      border-radius: 4px;
      width: 30px;
      height: 36px;
      display: none;
      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤º */
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
    }

    .mobile-snap-note {
      display: none;
      font-size: 10px;
      color: #e53935;
      margin-top: 8px;
      font-weight: bold;
    }

    .dropdown-panel.open {
      display: block;
    }

    .section-title {
      font-size: 11px;
      font-weight: bold;
      color: #888;
      margin: 10px 0 6px 0;
      padding-bottom: 4px;
      border-bottom: 1px dashed #ddd;
    }

    .btn-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .grid-btn {
      padding: 8px 4px;
      font-size: 11px;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      color: #666;
      transition: 0.2s;
    }

    .grid-btn.active {
      background: #a8d5e2;
      color: #005662;
      border-color: #81b3c3;
      font-weight: bold;
    }

    .param-area {
      display: none;
      background: #eef7ff;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      border: 1px solid #cce4f7;
    }

    .param-area.show {
      display: block;
    }

    .param-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .param-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .param-item span {
      font-size: 10px;
      color: #666;
      margin-bottom: 4px;
    }

    .param-item input {
      width: 100%;
      padding: 8px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
      font-weight: bold;
    }

    .btn-confirm {
      background: #4facfe;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 12px;
      margin-top: 10px;
      width: 100%;
    }

    /* ===== åˆ‡æ–­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ===== */
    .cut-section {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: 10px;
      flex: 1;
    }

    .cut-tabs-wrapper {
      background: #eee;
      border-radius: 20px;
      padding: 3px;
      overflow-x: auto;
      max-width: 700px;
      scrollbar-width: none;
    }

    .cut-tabs-wrapper::-webkit-scrollbar {
      display: none;
    }

    .cut-tabs {
      display: flex;
      gap: 4px;
    }

    .cut-tab {
      background: #f9f9f9;
      border: none;
      padding: 6px 14px;
      border-radius: 14px;
      font-weight: bold;
      cursor: pointer;
      font-size: 11px;
      white-space: nowrap;
      flex-shrink: 0;
      transition: 0.2s;
      border-bottom: 3px solid transparent;
    }

    .tab-color-0 {
      color: #ff0000;
    }

    .tab-color-0.active {
      background: rgba(255, 0, 0, 0.1);
      border-bottom-color: #ff0000;
    }

    .tab-color-1 {
      color: #008000;
    }

    .tab-color-1.active {
      background: rgba(0, 128, 0, 0.1);
      border-bottom-color: #008000;
    }

    .tab-color-2 {
      color: #0000ff;
    }

    .tab-color-2.active {
      background: rgba(0, 0, 255, 0.1);
      border-bottom-color: #0000ff;
    }

    .tab-color-3 {
      color: #ff8c00;
    }

    .tab-color-3.active {
      background: rgba(255, 140, 0, 0.1);
      border-bottom-color: #ff8c00;
    }

    .tab-color-4 {
      color: #800080;
    }

    .tab-color-4.active {
      background: rgba(128, 0, 128, 0.1);
      border-bottom-color: #800080;
    }

    .tab-color-5 {
      color: #00ced1;
    }

    .tab-color-5.active {
      background: rgba(0, 206, 209, 0.1);
      border-bottom-color: #00ced1;
    }

    .tab-color-6 {
      color: #ff00ff;
    }

    .tab-color-6.active {
      background: rgba(255, 0, 255, 0.1);
      border-bottom-color: #ff00ff;
    }

    .tab-color-7 {
      color: #133b8b;
    }

    .tab-color-7.active {
      background: rgba(19, 59, 139, 0.1);
      border-bottom-color: #133b8b;
    }

    .controls-right {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
    }

    #status-box {
      font-size: 13px;
      font-weight: bold;
      color: #555;
      min-width: 45px;
      text-align: center;
    }

    #btn-flip {
      background: #ffb74d;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      display: none;
      font-size: 11px;
      white-space: nowrap;
    }

    .btn-current-reset {
      background: #90a4ae;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      display: none;
      font-size: 11px;
      white-space: nowrap;
    }

    .btn-all-reset {
      background: #ef5350;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 11px;
      white-space: nowrap;
    }

    /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼å³å´ ===== */
    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-btn {
      color: white;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }

    .header-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .app-version {
      font-size: 12px;
      margin-left: 8px;
      opacity: 0.8;
      font-weight: normal;
    }

    /* ===== ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ« ===== */
    .help-btn {
      background: #9575cd;
      border: 1px solid #7e57c2;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: 0.2s;
      white-space: nowrap;
      position: relative;
    }

    /* PCã§ã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ã„æ–¹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º */
    @media (min-width: 951px) {

      .help-btn,
      .hide-on-pc {
        display: none;
      }
    }

    .help-panel {
      display: none;
      position: fixed;
      top: 50px;
      right: 15px;
      margin-top: 4px;
      /* å‰Šé™¤äºˆå®š */
      background: white;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 20px;
      min-width: 320px;
      z-index: 200;
      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ */
      max-height: 80vh;
      overflow-y: auto;
    }

    .help-panel.open {
      display: block;
    }

    /* ... omitted parts to match context ... */

    @media (max-width: 950px) {
      /* ... existing styles ... */

      .cut-section {
        width: 100%;
        margin: 0;
        border-top: 1px solid #eee;
        padding: 6px 0;
        order: 3;
        flex-direction: column;
        gap: 8px;
      }

      .guide-pc {
        display: none !important;
      }

      .guide-mobile {
        display: block !important;
      }
    }

    .help-title {
      font-size: 15px;
      font-weight: bold;
      color: #333;
      margin-bottom: 12px;
      border-bottom: 2px solid #9575cd;
      padding-bottom: 5px;
    }

    .help-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px dashed #eee;
    }

    .help-item:last-child {
      border-bottom: none;
    }

    .help-icon {
      font-size: 22px;
      min-width: 30px;
      text-align: center;
    }

    .help-text {
      font-size: 13px;
      color: #555;
      line-height: 1.6;
    }

    .help-text strong {
      color: #000;
      font-size: 14px;
    }



    @media (max-width: 950px) {

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒœã‚¿ãƒ³ç¾¤ã¯ã‚¹ãƒãƒ›ã§ã¯éè¡¨ç¤º */
      .header-btn {
        display: none;
      }

      #top-nav {
        padding: 4px;
        gap: 4px;
        top: 44px;
        /* é«˜ã•ãŒè‡ªå‹•èª¿æ•´ã•ã‚Œã‚‹ã‚ˆã†ã«max-heightã¯ä¸€æ—¦è§£é™¤ã€ã¾ãŸã¯å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹ */
        max-height: 80vh;
        overflow-y: auto;
        justify-content: space-between;
      }

      /* 1æ®µç›®: å›³å½¢ã€ç­‰åˆ†ã€ä½¿ã„æ–¹ã®3ã¤ã‚’æ¨ªä¸¦ã³ */
      .nav-tab,
      .help-btn {
        padding: 6px 2px;
        font-size: 10px;
        flex: 0 0 32%;
        /* 3ã¤ã§ã»ã¼100% */
        justify-content: center;
        margin: 0;
        appearance: none;
        -webkit-appearance: none;
        border-radius: 4px;
        height: 34px;
        /* é«˜ã•çµ±ä¸€ */
      }

      .cut-section {
        width: 100%;
        margin: 0;
        border-top: 1px solid #eee;
        padding: 4px 0;
        order: 3;
        flex-direction: column;
        gap: 4px;
      }

      /* 2æ®µç›®: åˆ‡æ–­ã‚¿ãƒ– */
      .cut-tabs-wrapper {
        width: 100%;
        background: #f0f0f0;
        border-radius: 6px;
        padding: 2px;
        overflow-x: auto;
        /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨±å¯ */
        white-space: nowrap;
      }

      .cut-tabs {
        display: flex;
        /* gridã‚’ä¸Šæ›¸ãã—ã¦æ¨ªä¸¦ã³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        width: 100%;
        /* ä¸­èº«ãŒç¸®ã¾ãªã„ã‚ˆã†ã« */
        min-width: 300px;
        /* æœ€ä½å¹…ç¢ºä¿ */
      }

      .cut-tab {
        flex: 1;
        padding: 6px 0;
        font-size: 10px;
        border-radius: 4px;
        text-align: center;
      }

      /* 3æ®µç›®ä»¥é™: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« + ãƒˆã‚°ãƒ« */
      .controls-right {
        width: 100%;
        margin: 0;
        border-top: 1px dashed #eee;
        padding-top: 4px;
        justify-content: space-between;
        flex-wrap: wrap;
        /* æŠ˜ã‚Šè¿”ã—è¨±å¯ */
        gap: 4px;
      }

      #status-box {
        font-size: 11px;
        min-width: 30px;
      }

      #btn-flip,
      .btn-current-reset,
      .btn-all-reset {
        padding: 6px 8px;
        font-size: 10px;
        flex-grow: 1;
      }

      .toggles-wrapper {
        width: 100%;
        display: flex;
        gap: 4px;
        margin-top: 4px;
      }

      .toggles-wrapper button {
        flex: 1;
        font-size: 10px;
        padding: 6px 0;
      }

      .dropdown-panel,
      .help-panel {
        position: fixed;
        /* fix: ãƒŠãƒ“ã®overflowã«ã‚ˆã‚‹åˆ‡ã‚Šå–ã‚‰ã‚Œã‚’å›é¿ */
        top: 15vh;
        left: 50%;
        transform: translateX(-50%);
        width: 90vw;
        max-height: 70vh;
        overflow-y: auto;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        border: 1px solid #999;
      }

      .bg-guide {
        display: block;
        bottom: 80px;
        left: 10px;
        right: 10px;
        width: auto;
      }

      .bg-guide .guide-pc {
        display: none;
      }

      .bg-guide .guide-mobile {
        display: block;
      }

      /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼è¡¨ç¤º */
      .stepper-btn {
        display: flex;
      }

      /* 6ç­‰åˆ†ä»¥ä¸Šã‚’éè¡¨ç¤º */
      .snap-high-res {
        display: none !important;
      }

      .mobile-snap-note {
        display: block;
      }
    }

    /* ===== èƒŒæ™¯ã‚¬ã‚¤ãƒ‰è¡¨ç¤º ===== */
    .bg-guide {
      position: fixed;
      bottom: 10px;
      right: 10px;
      /* é€éèƒŒæ™¯ */
      background: rgba(255, 255, 255, 0.85);
      /* è¦–èªæ€§å‘ä¸Šã®ãŸã‚ä¸é€æ˜åº¦ã‚¢ãƒƒãƒ— */
      backdrop-filter: blur(4px);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 11px;
      color: #222;
      /* æ–‡å­—è‰²ã‚’æ¿ƒã */
      pointer-events: none;
      /* 3Dæ“ä½œã‚’é˜»å®³ã—ãªã„ */
      user-select: none;
      z-index: 50;
      border: 1px solid rgba(0, 0, 0, 0.2);
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .bg-guide strong {
      color: #000;
      font-weight: bold;
      margin-right: 4px;
    }
  </style>
</head>

<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PRPCBPS2" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>

  <header id="app-header">
    <div style="width:20px;"></div>
    <h1>ç«‹ä½“å›³å½¢ã‚¹ãƒ©ã‚¤ã‚µãƒ¼ <span class="app-version">ver 1.1</span></h1>
    <div class="header-right">
      <div class="header-btn nav-trigger-pc" onclick="toggleDropdown('panel-shape')">ğŸ“ å›³å½¢é¸æŠ</div>
      <div class="header-btn nav-trigger-pc" onclick="toggleDropdown('panel-snap')">ğŸ“ ç­‰åˆ†ç‚¹è¨­å®š</div>
      <div class="header-btn help-trigger-pc" onclick="toggleDropdown('panel-help')">ğŸ“– ä½¿ã„æ–¹</div>
      <a href="../index.html" class="btn-home">ğŸ <span>ãƒ›ãƒ¼ãƒ </span></a>
    </div>
  </header>

  <nav id="top-nav">
    <div class="nav-tab hide-on-pc" onclick="toggleDropdown('panel-shape')">ğŸ“ å›³å½¢é¸æŠ</div>
    <div class="nav-tab hide-on-pc" onclick="toggleDropdown('panel-snap')">ğŸ“ ç­‰åˆ†ç‚¹è¨­å®š</div>
    <div class="help-btn" onclick="toggleDropdown('panel-help')">ğŸ“– ä½¿ã„æ–¹</div>

    <div class="dropdown-panel" id="panel-shape">
      <div class="section-title">åŸºæœ¬å›³å½¢</div>
      <div class="btn-grid">
        <button class="grid-btn active" onclick="setShapeUI('cube')">ç«‹æ–¹ä½“</button>
        <button class="grid-btn" onclick="setShapeUI('box')">ç›´æ–¹ä½“</button>
        <button class="grid-btn" onclick="setShapeUI('sphere')">çƒ</button>
      </div>
      <div id="cube-params" class="param-area">
        <div class="param-row">
          <div class="param-item"><span>ä¸€è¾ºã®é•·ã•</span>
            <div class="stepper-wrapper">
              <button class="stepper-btn" onclick="stepParam('inp-cube-s', -1, 'cube')">ï¼</button>
              <input type="number" id="inp-cube-s" value="6" min="2" max="12" onchange="setShape('cube')">
              <button class="stepper-btn" onclick="stepParam('inp-cube-s', 1, 'cube')">ï¼‹</button>
            </div>
          </div>
        </div>
        <button class="btn-confirm" onclick="closeAll()">OK æ±ºå®šã—ã¦é–‰ã˜ã‚‹</button>
      </div>
      <div id="box-params" class="param-area">
        <div class="param-row">

          <div class="param-item"><span>æ¨ª</span>
            <div class="stepper-wrapper">
              <button class="stepper-btn" onclick="stepParam('inp-w', -1, 'box')">ï¼</button>
              <input type="number" id="inp-w" value="5" onchange="setShape('box')">
              <button class="stepper-btn" onclick="stepParam('inp-w', 1, 'box')">ï¼‹</button>
            </div>
          </div>
          <div class="param-item"><span>é«˜</span>
            <div class="stepper-wrapper">
              <button class="stepper-btn" onclick="stepParam('inp-h', -1, 'box')">ï¼</button>
              <input type="number" id="inp-h" value="8" onchange="setShape('box')">
              <button class="stepper-btn" onclick="stepParam('inp-h', 1, 'box')">ï¼‹</button>
            </div>
          </div>
          <div class="param-item"><span>å¥¥</span>
            <div class="stepper-wrapper">
              <button class="stepper-btn" onclick="stepParam('inp-d', -1, 'box')">ï¼</button>
              <input type="number" id="inp-d" value="5" onchange="setShape('box')">
              <button class="stepper-btn" onclick="stepParam('inp-d', 1, 'box')">ï¼‹</button>
            </div>
          </div>
        </div>
        <button class="btn-confirm" onclick="closeAll()">OK æ±ºå®šã—ã¦é–‰ã˜ã‚‹</button>
      </div>
      <div class="section-title">æŸ±ä½“ãƒ»éŒä½“ãƒ»å¤šé¢ä½“</div>
      <div class="btn-grid">
        <button class="grid-btn" onclick="setShapeUI('prism-3')">ä¸‰è§’æŸ±</button>
        <button class="grid-btn" onclick="setShapeUI('prism-5')">äº”è§’æŸ±</button>
        <button class="grid-btn" onclick="setShapeUI('prism-6')">å…­è§’æŸ±</button>
        <button class="grid-btn" onclick="setShapeUI('cylinder')">å††æŸ±</button>
        <button class="grid-btn" onclick="setShapeUI('pyramid-3')">ä¸‰è§’éŒ</button>
        <button class="grid-btn" onclick="setShapeUI('pyramid-4')">å››è§’éŒ</button>
        <button class="grid-btn" onclick="setShapeUI('pyramid-5')">äº”è§’éŒ</button>
        <button class="grid-btn" onclick="setShapeUI('pyramid-6')">å…­è§’éŒ</button>
        <button class="grid-btn" onclick="setShapeUI('cone')">å††éŒ</button>
        <button class="grid-btn" onclick="setShapeUI('poly-4')">æ­£å››é¢ä½“</button>
        <button class="grid-btn" onclick="setShapeUI('poly-8')">æ­£å…«é¢ä½“</button>
        <button class="grid-btn" onclick="setShapeUI('poly-12')">æ­£åäºŒé¢ä½“</button>
        <button class="grid-btn" onclick="setShapeUI('poly-20')">æ­£äºŒåé¢ä½“</button>
      </div>
    </div>



    <div class="dropdown-panel" id="panel-snap">
      <div class="section-title">ã‚¨ãƒƒã‚¸ã®åˆ†å‰²æ•°</div>
      <div class="btn-grid">
        <button class="grid-btn active snap-ui" onclick="setDivisionUI(1)">é ‚ç‚¹ã®ã¿</button>
        <button class="grid-btn snap-ui" onclick="setDivisionUI(2)">2ç­‰åˆ†</button>
        <button class="grid-btn snap-ui" onclick="setDivisionUI(3)">3ç­‰åˆ†</button>
        <button class="grid-btn snap-ui" onclick="setDivisionUI(4)">4ç­‰åˆ†</button>
        <button class="grid-btn snap-ui" onclick="setDivisionUI(5)">5ç­‰åˆ†</button>
        <button class="grid-btn snap-ui snap-high-res" onclick="setDivisionUI(6)">6ç­‰åˆ†</button>
        <button class="grid-btn snap-ui snap-high-res" onclick="setDivisionUI(8)">8ç­‰åˆ†</button>
        <button class="grid-btn snap-ui snap-high-res" onclick="setDivisionUI(10)">10ç­‰åˆ†</button>
      </div>
      <div class="mobile-snap-note">â€»ã‚¹ãƒãƒ›ç‰ˆã¯5ç­‰åˆ†ã¾ã§ã§ã™ã€‚6ç­‰åˆ†ä»¥ä¸Šã¯PCç‰ˆã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</div>
    </div>

    <div class="help-panel" id="panel-help">
      <div class="help-title">æ“ä½œæ–¹æ³•</div>
      <div class="help-item">
        <div class="help-text guide-pc">
          <div>ğŸ–±ï¸ <strong>å·¦ãƒ‰ãƒ©ãƒƒã‚°</strong>ï¼šå›è»¢</div>
          <div>ğŸ–±ï¸ <strong>å³ãƒ‰ãƒ©ãƒƒã‚°</strong>ï¼šç§»å‹•</div>
          <div>ğŸ”˜ <strong>ãƒ›ã‚¤ãƒ¼ãƒ«</strong>ï¼šæ‹¡ç¸®</div>
          <div>ğŸ‘† <strong>ã‚¯ãƒªãƒƒã‚¯</strong>ï¼šç‚¹ã®é¸æŠ</div>
        </div>
        <div class="help-text guide-mobile" style="display:none;">
          <div>â˜ï¸ <strong>1æœ¬æŒ‡</strong>ï¼šå›è»¢</div>
          <div>âœŒï¸ <strong>2æœ¬æŒ‡</strong>ï¼šç§»å‹•</div>
          <div>ğŸ¤ <strong>ãƒ”ãƒ³ãƒ</strong>ï¼šæ‹¡ç¸®</div>
          <div>ğŸ‘† <strong>ã‚¿ãƒƒãƒ—</strong>ï¼šç‚¹ã®é¸æŠ</div>
        </div>
      </div>

      <div class="help-title">ä½¿ã„æ–¹ã‚¹ãƒ†ãƒƒãƒ—</div>
      <div class="help-item">
        <span class="help-icon">1ï¸âƒ£</span>
        <div class="help-text"><strong>å›³å½¢ã‚’é¸ã¶</strong><br>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œï¿½ å›³å½¢é¸æŠã€ã‹ã‚‰å¥½ããªç«‹ä½“ã‚’é¸ã³ã¾ã™ã€‚<br>å¯¸æ³•ã‚‚è‡ªç”±ã«å¤‰æ›´ã§ãã¾ã™ã€‚</div>
      </div>
      <div class="help-item">
        <span class="help-icon">2ï¸âƒ£</span>
        <div class="help-text"><strong>ç­‰åˆ†ç‚¹ã‚’è¨­å®š</strong><br>ã€ŒğŸ“ ç­‰åˆ†ç‚¹è¨­å®šã€ã§ã€è¾ºä¸Šã®ç‚¹ã®æ•°ï¼ˆåˆ†å‰²æ•°ï¼‰ã‚’æ±ºã‚ã¾ã™ã€‚<br>ã€Œé ‚ç‚¹ã®ã¿ã€ã‚„ã€Œ3ç­‰åˆ†ã€ãªã©ã‚’é¸ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚
        </div>
      </div>
      <div class="help-item">
        <span class="help-icon">3ï¸âƒ£</span>
        <div class="help-text"><strong>åˆ‡æ–­ã™ã‚‹</strong><br>ç«‹ä½“ä¸Šã®ç‚¹ã‚’ <strong>3ã¤</strong> é †ç•ªã«é¸ã¶ã¨ã€ãã®3ç‚¹ã‚’é€šã‚‹é¢ã§åˆ‡æ–­ã•ã‚Œã¾ã™ã€‚<br>å¤±æ•—ã—ãŸã‚‰ã€ŒğŸ—‘ï¸
          æ¶ˆã™ã€ã§ã‚„ã‚Šç›´ã›ã¾ã™ã€‚</div>
      </div>
      <div class="help-item">
        <span class="help-icon">4ï¸âƒ£</span>
        <div class="help-text"><strong>æ–­é¢ã®æ“ä½œ</strong><br>ã€ŒğŸ” é€†å´ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€åˆ‡ã‚Šå–ã‚‰ã‚Œã‚‹å´ï¼ˆæ®‹ã‚‹å´ï¼‰ã‚’å…¥ã‚Œæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚</div>
      </div>
      <div class="help-item">
        <span class="help-icon">5ï¸âƒ£</span>
        <div class="help-text"><strong>è¤‡æ•°å›åˆ‡æ–­</strong><br>ç”»é¢ä¸‹ã®ã‚¿ãƒ–ï¼ˆåˆ‡æ–­â‘ ã€œâ‘§ï¼‰ã‚’ä½¿ã£ã¦ã€æœ€å¤§8å›ã¾ã§åˆ‡æ–­ã‚’é‡ã­ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</div>
      </div>
    </div>

    <div class="cut-section">
      <div class="cut-tabs-wrapper">
        <div class="cut-tabs">
          <button class="cut-tab active tab-color-0" id="tab-0" onclick="switchCutTab(0)">åˆ‡æ–­â‘ </button>
          <button class="cut-tab tab-color-1" id="tab-1" onclick="switchCutTab(1)">åˆ‡æ–­â‘¡</button>
          <button class="cut-tab tab-color-2" id="tab-2" onclick="switchCutTab(2)">åˆ‡æ–­â‘¢</button>
          <button class="cut-tab tab-color-3" id="tab-3" onclick="switchCutTab(3)">åˆ‡æ–­â‘£</button>
          <button class="cut-tab tab-color-4" id="tab-4" onclick="switchCutTab(4)">åˆ‡æ–­â‘¤</button>
          <button class="cut-tab tab-color-5" id="tab-5" onclick="switchCutTab(5)">åˆ‡æ–­â‘¥</button>
          <button class="cut-tab tab-color-6" id="tab-6" onclick="switchCutTab(6)">åˆ‡æ–­â‘¦</button>
          <button class="cut-tab tab-color-7" id="tab-7" onclick="switchCutTab(7)">åˆ‡æ–­â‘§</button>
        </div>
      </div>
      <div class="controls-right">
        <span id="status-box">0 / 3</span>
        <button id="btn-flip" onclick="flipCurrentCut()">ğŸ” é€†å´</button>
        <button class="btn-current-reset" id="btn-reset-single" onclick="resetCurrentCut()">ğŸ—‘ï¸ æ¶ˆã™</button>
        <button class="btn-all-reset" onclick="resetAll()">ğŸ—‘ï¸ å…¨ãƒªã‚»ãƒƒãƒˆ</button>
        <div class="toggles-wrapper">
          <button class="nav-tab active" id="btn-toggle-wire" onclick="toggleWireframe()">ğŸ•¸ï¸ è£œåŠ©ç·šï¼šON</button>
          <button class="nav-tab active" id="btn-toggle-snap" onclick="toggleSnapPoints()">âš« ç‚¹ï¼šON</button>
        </div>
      </div>
    </div>
  </nav>



  <script>
    let scene, camera, renderer, controls;
    let planes = [], cutPoints = [], cutMarkers = [], capMeshes = [], currentCutIndex = 0;
    const MAX_CUTS = 8;
    let currentMesh, wireMesh, currentGeo, currentEdgesGeo;
    let snapGroup = new THREE.Group();
    let openDropdown = null;
    let curDiv = 1;
    let showWire = true;
    let showSnap = true;

    const CUT_COLORS = [0xff0000, 0x008000, 0x0000ff, 0xff8c00, 0x800080, 0x00ced1, 0xff00ff, 0x133b8b];

    function toggleDropdown(id) {
      const panel = document.getElementById(id);
      if (openDropdown && openDropdown !== panel) openDropdown.classList.remove('open');
      panel.classList.toggle('open');
      openDropdown = panel.classList.contains('open') ? panel : null;
    }
    function closeAll() { if (openDropdown) { openDropdown.classList.remove('open'); openDropdown = null; } }

    function setShapeUI(type) {
      document.querySelectorAll('#panel-shape .grid-btn').forEach(b => b.classList.remove('active'));
      setShape(type);
      document.getElementById('cube-params').classList.toggle('show', type === 'cube');
      document.getElementById('box-params').classList.toggle('show', type === 'box');
      if (type !== 'cube' && type !== 'box') closeAll();
    }

    function setDivisionUI(div) { curDiv = div; setDivision(div); closeAll(); }

    function stepParam(id, delta, type) {
      const el = document.getElementById(id);
      let val = parseFloat(el.value) + delta;
      if (val < 1) val = 1;
      if (id === 'inp-cube-s') {
        if (val < 2) val = 2;
        if (val > 12) val = 12;
      }
      el.value = val;
      setShape(type);
    }

    function init() {
      scene = new THREE.Scene(); scene.background = new THREE.Color(0xfdfcf5);
      camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(20, 20, 26);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.localClippingEnabled = true;
      document.body.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      // è¡¨ç¤ºä½ç½®ã®ä¿®æ­£ï¼šåŸç‚¹(0,0,0)ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹
      controls.target.set(0, 0, 0);

      const ambientLight = new THREE.AmbientLight(0x808080); scene.add(ambientLight);
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8); dirLight.position.set(10, 20, 10); scene.add(dirLight);

      for (let i = 0; i < MAX_CUTS; i++) {
        planes.push(new THREE.Plane(new THREE.Vector3(0, -1, 0), 10000));
        cutPoints.push([]); cutMarkers.push([]); capMeshes.push(null);
      }
      scene.add(snapGroup);
      setShape('cube'); animate();
    }

    function setShape(type) {
      resetAllInternal();
      if (currentMesh) scene.remove(currentMesh, wireMesh);
      let geo, edgeGeo;
      if (type === 'cube') {
        const s = parseFloat(document.getElementById('inp-cube-s').value);
        geo = new THREE.BoxGeometry(s, s, s);
        edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'box') {
        geo = new THREE.BoxGeometry(parseFloat(document.getElementById('inp-w').value), parseFloat(document.getElementById('inp-h').value), parseFloat(document.getElementById('inp-d').value));
        edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'sphere') {
        geo = new THREE.SphereGeometry(6, 48, 48);
        edgeGeo = new THREE.EdgesGeometry(new THREE.SphereGeometry(6, 12, 10));
      } else if (type === 'prism-3') {
        geo = new THREE.CylinderGeometry(5, 5, 9, 3); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'prism-5') {
        geo = new THREE.CylinderGeometry(5, 5, 9, 5); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'prism-6') {
        geo = new THREE.CylinderGeometry(5, 5, 9, 6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'cylinder') {
        geo = new THREE.CylinderGeometry(4, 4, 9, 32); edgeGeo = new THREE.EdgesGeometry(new THREE.CylinderGeometry(4, 4, 9, 12));
      } else if (type === 'pyramid-3') {
        geo = new THREE.ConeGeometry(6, 9, 3); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'pyramid-4') {
        geo = new THREE.ConeGeometry(6, 9, 4); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'pyramid-5') {
        geo = new THREE.ConeGeometry(6, 9, 5); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'pyramid-6') {
        geo = new THREE.ConeGeometry(6, 9, 6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'cone') {
        geo = new THREE.ConeGeometry(6, 9, 32); edgeGeo = new THREE.EdgesGeometry(new THREE.ConeGeometry(6, 9, 12));
      } else if (type === 'poly-4') {
        geo = new THREE.TetrahedronGeometry(6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'poly-8') {
        geo = new THREE.OctahedronGeometry(6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'poly-12') {
        geo = new THREE.DodecahedronGeometry(6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else if (type === 'poly-20') {
        geo = new THREE.IcosahedronGeometry(6); edgeGeo = new THREE.EdgesGeometry(geo);
      } else {
        geo = new THREE.BoxGeometry(6, 6, 6); edgeGeo = new THREE.EdgesGeometry(geo);
      }

      // è¡¨ç¤ºä½ç½®ã®ä¿®æ­£ï¼štranslate(3,0,0)ã‚’å‰Šé™¤ã—ã¦ä¸­å¤®é…ç½®
      currentGeo = geo; currentEdgesGeo = edgeGeo;
      currentMesh = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({ color: 0xa8d5e2, side: THREE.DoubleSide, clippingPlanes: planes, clipShadows: true }));
      wireMesh = new THREE.LineSegments(edgeGeo, new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true }));
      scene.add(currentMesh, wireMesh);
      wireMesh.visible = showWire; // ç¾åœ¨ã®è¡¨ç¤ºè¨­å®šã‚’é©ç”¨
      setDivision(curDiv);
    }

    const isTouchDevice = () => ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

    function setDivision(div) {
      snapGroup.clear();
      const snapSize = isTouchDevice() ? 0.45 : 0.2;
      const dotMat = new THREE.MeshBasicMaterial({ color: 0x555555, opacity: 0.4, transparent: true });
      // ä¿®æ­£: ã‚¹ãƒŠãƒƒãƒ—ç‚¹ã®ç”Ÿæˆå…ƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”¨ãƒ¡ãƒƒã‚·ãƒ¥(é«˜è©³ç´°)ã‹ã‚‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç”¨ãƒ¡ãƒƒã‚·ãƒ¥(ä½è©³ç´°)ã«å¤‰æ›´
      const posAttr = currentEdgesGeo ? currentEdgesGeo.attributes.position : currentMesh.geometry.attributes.position;
      const vertexSet = new Set();

      for (let i = 0; i < posAttr.count; i++) {
        const v = new THREE.Vector3().fromBufferAttribute(posAttr, i);
        // è§’æŸ±/å††æŸ±ã®ä¸­å¿ƒç‚¹ã‚’æ’é™¤ï¼ˆã‚»ãƒ³ã‚¿ãƒ¼åŒ–ã«ä¼´ã„åŸç‚¹åˆ¤å®šã«å¤‰æ›´ï¼‰
        const isPyramidApex = currentGeo.type === "ConeGeometry" && Math.abs(v.y - 4.5) < 0.01 && Math.abs(v.x - 0) < 0.01;
        const isCenterPoint = !isPyramidApex && Math.abs(v.x - 0) < 0.01 && Math.abs(v.z - 0) < 0.01;
        if (isCenterPoint) continue;

        const key = `${v.x.toFixed(3)},${v.y.toFixed(3)},${v.z.toFixed(3)}`;
        if (!vertexSet.has(key)) {
          const dot = new THREE.Mesh(new THREE.SphereGeometry(snapSize), dotMat);
          dot.position.copy(v); snapGroup.add(dot); vertexSet.add(key);
        }
      }

      if (div > 1 && currentEdgesGeo) {
        const attr = currentEdgesGeo.attributes.position;
        for (let i = 0; i < attr.count; i += 2) {
          const v1 = new THREE.Vector3().fromBufferAttribute(attr, i);
          const v2 = new THREE.Vector3().fromBufferAttribute(attr, i + 1);
          for (let j = 1; j < div; j++) {
            const dot = new THREE.Mesh(new THREE.SphereGeometry(snapSize), dotMat);
            dot.position.lerpVectors(v1, v2, j / div); snapGroup.add(dot);
          }
        }
      }
    }

    function calculateIntersectionPointsAndCreateCap(plane, idx) {
      const pts = []; const attr = currentEdgesGeo.attributes.position;
      for (let i = 0; i < attr.count; i += 2) {
        const v1 = new THREE.Vector3().fromBufferAttribute(attr, i), v2 = new THREE.Vector3().fromBufferAttribute(attr, i + 1);
        const line = new THREE.Line3(v1, v2); const target = new THREE.Vector3();
        if (plane.intersectLine(line, target)) if (!pts.some(p => p.distanceTo(target) < 0.01)) pts.push(target.clone());
      }
      if (capMeshes[idx]) scene.remove(capMeshes[idx]);
      if (pts.length >= 3) {
        const center = new THREE.Vector3(); pts.forEach(p => center.add(p)); center.divideScalar(pts.length);
        const normal = plane.normal.clone(); let ref = new THREE.Vector3(0, 1, 0); if (Math.abs(normal.dot(ref)) > 0.9) ref.set(1, 0, 0);
        const xDir = ref.cross(normal).normalize(), yDir = normal.clone().cross(xDir).normalize();
        pts.sort((a, b) => Math.atan2(a.clone().sub(center).dot(yDir), a.clone().sub(center).dot(xDir)) - Math.atan2(b.clone().sub(center).dot(yDir), b.clone().sub(center).dot(xDir)));
        const shape = new THREE.Shape(pts.map(p => new THREE.Vector2(p.clone().sub(center).dot(xDir), p.clone().sub(center).dot(yDir))));
        const cap = new THREE.Mesh(new THREE.ShapeGeometry(shape), new THREE.MeshPhongMaterial({ color: CUT_COLORS[idx], side: THREE.DoubleSide, opacity: 0.6, transparent: true, clippingPlanes: planes.filter((_, i) => i !== idx) }));
        const m = new THREE.Matrix4().makeBasis(xDir, yDir, normal); cap.applyMatrix4(m); cap.position.copy(center);
        capMeshes[idx] = cap; scene.add(cap);
      }
    }

    const raycaster = new THREE.Raycaster(), mouse = new THREE.Vector2();
    if (isTouchDevice()) { raycaster.params.Points.threshold = 1.5; }

    window.addEventListener('pointerdown', (e) => {
      if (e.target.closest('#top-nav') || e.target.closest('#app-header')) return;
      mouse.x = (e.clientX / window.innerWidth) * 2 - 1; mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera); const hits = raycaster.intersectObjects(snapGroup.children);
      if (hits.length > 0) {
        const p = hits[0].object.position.clone(); if (cutPoints[currentCutIndex].length >= 3) return;
        cutPoints[currentCutIndex].push(p);
        const markerSize = isTouchDevice() ? 0.5 : 0.35;
        const m = new THREE.Mesh(new THREE.SphereGeometry(markerSize, 12, 10), new THREE.MeshBasicMaterial({ color: CUT_COLORS[currentCutIndex] }));
        m.position.copy(p); m.renderOrder = 999; scene.add(m); cutMarkers[currentCutIndex].push(m);
        updateUI(); if (cutPoints[currentCutIndex].length === 3) applyCut();
      }
    });

    function applyCut() { const p = cutPoints[currentCutIndex]; planes[currentCutIndex].setFromCoplanarPoints(p[0], p[1], p[2]); calculateIntersectionPointsAndCreateCap(planes[currentCutIndex], currentCutIndex); updateUI(); }
    function updateUI() {
      const len = cutPoints[currentCutIndex].length; document.getElementById('status-box').innerText = `${len} / 3`;
      document.getElementById('btn-flip').style.display = (len === 3) ? 'block' : 'none';
      document.getElementById('btn-reset-single').style.display = (len > 0) ? 'block' : 'none';
      for (let i = 0; i < MAX_CUTS; i++) { const t = document.getElementById('tab-' + i); if (t) { t.classList.toggle('active', i === currentCutIndex); t.classList.toggle('has-cut', cutPoints[i].length === 3); } }
    }
    window.switchCutTab = (idx) => { currentCutIndex = idx; updateUI(); };
    window.flipCurrentCut = () => { planes[currentCutIndex].normal.negate(); planes[currentCutIndex].constant *= -1; calculateIntersectionPointsAndCreateCap(planes[currentCutIndex], currentCutIndex); };
    window.resetCurrentCut = () => {
      cutPoints[currentCutIndex] = []; cutMarkers[currentCutIndex].forEach(m => scene.remove(m)); cutMarkers[currentCutIndex] = [];
      planes[currentCutIndex].setComponents(0, -1, 0, 10000); if (capMeshes[currentCutIndex]) scene.remove(capMeshes[currentCutIndex]);
      capMeshes[currentCutIndex] = null; updateUI();
    };

    window.toggleWireframe = () => {
      showWire = !showWire;
      if (wireMesh) wireMesh.visible = showWire;
      const btn = document.getElementById('btn-toggle-wire');
      btn.innerText = showWire ? "ğŸ•¸ï¸ è£œåŠ©ç·šï¼šON" : "ğŸ•¸ï¸ è£œåŠ©ç·šï¼šOFF";
      btn.classList.toggle('active', showWire);
    };

    window.toggleSnapPoints = () => {
      showSnap = !showSnap;
      snapGroup.visible = showSnap;
      const btn = document.getElementById('btn-toggle-snap');
      btn.innerText = showSnap ? "âš« ç‚¹ï¼šON" : "âš« ç‚¹ï¼šOFF";
      btn.classList.toggle('active', showSnap);
    };



    function resetAllInternal() { cutPoints.forEach((_, i) => { currentCutIndex = i; resetCurrentCut(); }); currentCutIndex = 0; updateUI(); }
    window.resetAll = () => { resetAllInternal(); };
    function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
    window.onload = () => {
      init();
    };
    window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
  </script>
</body>

</html>